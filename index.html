<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•á‡§µ‡§æ - ‡§ò‡§∞ ‡§™‡§∞ ‡§∏‡•á‡§µ‡§æ‡§è‡§Å</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* Base Styles */
    body { font-family: 'Poppins', sans-serif; margin: 0; background: #f7f7f9; color: #333; padding-bottom: 60px; }
    .container { padding: 20px; max-width: 1000px; margin: auto; }
    h1 { text-align: center; color: #007bff; margin-bottom: 20px; }
    h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-top: 20px; font-weight: 600; }
    .content-section { display: none; }
    .content-section.active { display: block; }

    /* Search + Category */
    .search-container { position: relative; margin-bottom: 20px; }
    #categorySearchInput { width: 100%; padding: 10px 40px 10px 15px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
    .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #007bff; }
    
    /* Styles for Suggestions */
    #categorySuggestions {
        position: absolute;
        width: 100%;
        max-height: 200px;
        overflow-y: auto;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 0 0 8px 8px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        z-index: 50;
        display: none; 
        top: 100%; 
    }
    .suggestion-item {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 1px solid #eee;
        color: #333;
    }
    .suggestion-item:last-child {
        border-bottom: none;
    }
    .suggestion-item:hover {
        background: #e6f7ff;
        font-weight: 600;
    }
    .suggestion-highlight {
        color: #007bff;
        font-weight: 700;
    }

    .category-navbar { background: #fff; padding: 8px 0; border-bottom: 1px solid #eee; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .category-list { display: flex; overflow-x: auto; list-style: none; padding: 0 10px; margin: 0; scrollbar-width: none; }
    .category-list::-webkit-scrollbar { display: none; }
    .category-item { flex-shrink: 0; margin-right: 10px; }
    .category-link { padding: 8px 15px; border-radius: 20px; border: 1px solid #ccc; color: #333; background: #fff; text-decoration: none; display: block; white-space: nowrap; }
    .category-link.active { background: #007bff; color: #fff; border-color: #007bff; }

    /* Cards */
    .karmchari-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px; min-height: 200px; }
    .karmchari-card { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); border-left: 5px solid #007bff; }
    .category-tag { background: #ffc107; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; display: inline-block; margin-bottom: 5px; }
    .contact-buttons { display: flex; gap: 10px; margin-top: 10px; }
    .contact-buttons a { flex: 1; text-align: center; padding: 10px; border-radius: 5px; color: #fff; text-decoration: none; font-weight: 600; }
    .call-btn { background: #dc3545; }
    .whatsapp-btn { background: #28a745; }

    /* Job Card Styles */
    .job-card { background: #e6f7ff; border: 1px solid #cceeff; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid #007bff; }
    .job-card p { margin: 5px 0; }
    .job-card strong { color: #007bff; }
    .job-card .action-buttons { margin-top: 10px; display: flex; gap: 10px; }
    .job-card .action-buttons button, .job-card .action-buttons a { padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: 600; flex: 1; }
    .job-card .edit-btn { background: #ffc107; color: #333; }
    .job-card .delete-btn { background: #dc3545; color: white; }
    
    /* Forms & Form Icons */
    .form-container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 15px; }
    .form-group-icon { position: relative; margin-bottom: 15px; }
    .form-group-icon .material-icons { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #007bff; font-size: 20px; pointer-events: none; }
    .form-group-icon input, .form-group-icon select, textarea {
        width: 100%; padding: 10px 10px 10px 40px; border-radius: 5px; border: 1px solid #ccc;
        box-sizing: border-box; transition: border-color 0.3s; 
    }
    textarea { padding-left: 10px !important; } 
    #employeeRegisterSection input, #employeeRegisterSection select { padding-left: 40px; }
    select { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding-right: 10px; }
    
    /* Buttons */
    .form-btn { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: 600; transition: background 0.3s;}
    .form-btn:hover { background: #0056b3; }
    
    /* Advanced Button Style for Registration */
    #employeeRegisterForm button { 
        background: linear-gradient(135deg, #28a745, #1e8736); 
        color: white;
        padding: 12px 15px; 
        border: none;
        border-radius: 8px; 
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.08); 
        cursor: pointer; 
        width: 100%; 
        margin-top: 15px; 
        font-weight: 700; 
        text-transform: uppercase; 
        letter-spacing: 0.5px;
        transition: all 0.2s ease;
        display: flex; 
        align-items: center; 
        justify-content: center; 
    }
    #employeeRegisterForm button:hover {
        background: linear-gradient(135deg, #1e8736, #156d2b); 
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1); 
    }
    #employeeRegisterForm button:active {
        transform: translateY(2px); 
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); 
    }
    
    /* Success State for Button */
    #employeeRegisterForm button[style*="background: rgb(21, 87, 36)"] { 
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15); 
        transform: none;
    }

    /* Loading Spinner */
    .loading-spinner { 
        border: 2px solid #f3f3f3; 
        border-top: 2px solid #fff; 
        border-radius: 50%; 
        width: 16px; 
        height: 16px; 
        animation: spin 0.8s linear infinite; 
        margin-right: 8px; 
    }
    @keyframes spin { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(360deg); } 
    }
    
    /* Messages */
    .message { margin-top: 10px; padding: 8px; border-radius: 4px; font-weight: bold; }
    .success-msg { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; display: none; }
    
    /* Disabled Input Style */
    #emp_new_category:disabled {
        background-color: #e9ecef;
        cursor: not-allowed;
    }

    /* Bottom Nav */
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-around; background: #fff; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 10; }
    .nav-item-bottom { display: flex; flex-direction: column; align-items: center; padding: 6px 0; font-size: 0.8em; text-decoration: none; color: #777; flex-grow: 1; min-width: 60px; }
    .nav-item-bottom.active { color: #007bff; font-weight: 600; }
    .nav-item-bottom span { font-size: 22px; }
  </style>
</head>
<body>

<div class="container">
  <!-- 1. üè† ‡§π‡•ã‡§Æ ‡§∏‡•á‡§ï‡•ç‡§∂‡§® (‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä) -->
  <div id="homeSection" class="content-section active">
    <h1>‡§π‡§Æ‡§æ‡§∞‡•á ‡§Ö‡§®‡•Å‡§≠‡§µ‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</h1>
    <div class="search-container">
      <input type="text" id="categorySearchInput" placeholder="‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ñ‡•ã‡§ú‡•á‡§Ç...">
      <span class="material-icons search-icon">search</span>
      <div id="categorySuggestions"></div>
    </div>
    <div class="category-navbar">
      <ul id="categoryNav" class="category-list">
        <!-- Categories load here -->
      </ul>
    </div>
    <div id="karmchariGrid" class="karmchari-grid">
      <p id="loadingMessage" style="text-align:center;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
    </div>
  </div>

  <!-- 2. üíº ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§æ‡§Æ -->
  <div id="availableJobsSection" class="content-section">
    <h1>‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§æ‡§Æ (<span id="jobPostCount">0</span> ‡§è‡§ï‡•ç‡§ü‡§ø‡§µ ‡§™‡•ã‡§∏‡•ç‡§ü)</h1>
    <div id="availableJobsContainer">
        <!-- Job posts render here -->
        <p style="text-align:center;">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ï‡§æ‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>
    </div>
  </div>

  <!-- 3. ‚ûï ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ (‡§ú‡•Å‡§°‡§º‡•á‡§Ç) -->
  <div id="employeeRegisterSection" class="content-section">
    <h2>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç</h2>
     <form id="employeeRegisterForm" class="form-container">
        
        <label for="emp_name">‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ</label>
        <div class="form-group-icon">
            <span class="material-icons">person</span>
            <input type="text" id="emp_name" placeholder="‡§ú‡•à‡§∏‡•á: ‡§Æ‡•ã‡§π‡§® ‡§≤‡§æ‡§≤" required>
        </div>
        
        <label for="emp_category">‡§Ü‡§™‡§ï‡•Ä ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡§§‡§æ (‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç)</label>
        <div class="form-group-icon">
            <span class="material-icons">engineering</span>
            <select id="emp_category" required>
                 <option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
            </select>
        </div>

        <!-- New Category Input -->
        <label for="emp_new_category">‡§Ö‡§®‡•ç‡§Ø: ‡§®‡§à ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</label>
        <div class="form-group-icon">
            <span class="material-icons">add_box</span>
            <input type="text" id="emp_new_category" placeholder="‡§ú‡•à‡§∏‡•á: ‡§ï‡§æ‡§∞ ‡§µ‡•â‡§∂ ‡§è‡§ï‡•ç‡§∏‡§™‡§∞‡•ç‡§ü" oninput="toggleCategorySelect(this.value)">
        </div>

        <label for="emp_exp">‡§Ö‡§®‡•Å‡§≠‡§µ (‡§µ‡§∞‡•ç‡§∑‡•ã‡§Ç ‡§Æ‡•á‡§Ç)</label>
        <div class="form-group-icon">
            <span class="material-icons">military_tech</span>
            <input type="number" id="emp_exp" min="0" max="50" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: 5" required>
        </div>
        
        <label for="emp_contact">‡§Ü‡§™‡§ï‡§æ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ (WhatsApp/Call)</label>
        <div class="form-group-icon">
            <span class="material-icons">phone</span>
            <input type="text" id="emp_contact" inputmode="numeric" placeholder="91XXXXXXXXXX" required>
        </div>

        <button type="submit" id="registerEmployeeBtn">
            <span class="material-icons" id="registerIcon" style="font-size: 18px; vertical-align: middle; margin-right: 5px;">how_to_reg</span>
            <span id="registerText">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç</span>
        </button>
        <p id="empRegisterMessage" class="message success-msg">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤! ‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§π‡•ã‡§Æ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§®‡•á ‡§≤‡§ó‡•á‡§ó‡§æ‡•§</p>
    </form>
  </div>

  <!-- 4. üë§ ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ (‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü) -->
  <div id="profileSection" class="content-section">
    <h2>‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</h2>
    <p>‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§</p>

    <form id="jobPostForm" class="form-container">
        <!-- Hidden field to track if we are editing -->
        <input type="hidden" id="editingPostId" value="">
        
        <label for="post_category">‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä</label>
        <div class="form-group-icon">
            <span class="material-icons">category</span>
            <select id="post_category" required>
                 <option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
            </select>
        </div>

        <label for="post_work_details">‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</label>
        <textarea id="post_work_details" rows="3" placeholder="‡§ú‡•à‡§∏‡•á: ‡§Æ‡•á‡§∞‡•á ‡§ò‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§á‡§™ ‡§ü‡•Ç‡§ü ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§á‡§∏‡•á ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§†‡•Ä‡§ï ‡§ï‡§∞‡§µ‡§æ‡§®‡§æ ‡§π‡•à‡•§" required></textarea>

        <label for="post_contact_name">‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
        <div class="form-group-icon">
            <span class="material-icons">person</span>
            <input type="text" id="post_contact_name" required>
        </div>

        <label for="post_contact_number">‡§Ü‡§™‡§ï‡§æ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ (WhatsApp/Call)</label>
        <div class="form-group-icon">
            <span class="material-icons">phone</span>
            <input type="text" id="post_contact_number" inputmode="numeric" placeholder="91XXXXXXXXXX" required>
        </div>

        <label for="post_duration">‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø/‡§Ö‡§µ‡§ß‡§ø</label>
        <div class="form-group-icon">
            <span class="material-icons">schedule</span>
            <input type="text" id="post_duration" placeholder="‡§ú‡•à‡§∏‡•á: 4 ‡§ò‡§Ç‡§ü‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ü‡§ú ‡§∂‡§æ‡§Æ ‡§ï‡•ã" required>
        </div>

        <button type="submit" class="form-btn" id="submitJobPostBtn">‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
        <p id="postMessage" class="message success-msg">‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡•Ä ‡§ó‡§à!</p>
    </form>
    
    <h2 style="margin-top: 30px;">‡§Ü‡§™‡§ï‡•Ä ‡§™‡§ø‡§õ‡§≤‡•Ä ‡§™‡•ã‡§∏‡•ç‡§ü (<span id="myPostCount">0</span>)</h2>
    <div id="myPostsContainer">
        <!-- User's previous posts render here -->
        <p style="text-align: center; color: #555;">‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•ã‡§à ‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡•§</p>
    </div>
  </div>
</div>

<!-- ‚öìÔ∏è ‡§¨‡•â‡§ü‡§Æ ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§® -->
<div class="bottom-nav">
  <a href="#" class="nav-item-bottom active" data-section="homeSection">
    <span class="material-icons">engineering</span> ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä
  </a>
  <a href="#" class="nav-item-bottom" data-section="availableJobsSection">
    <span class="material-icons">work_outline</span> ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§æ‡§Æ
  </a>
  <a href="#" class="nav-item-bottom" data-section="employeeRegisterSection">
    <span class="material-icons">person_add</span> ‡§ú‡•Å‡§°‡§º‡•á‡§Ç
  </a>
  <a href="#" class="nav-item-bottom" data-section="profileSection">
    <span class="material-icons">person</span> ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤
  </a>
</div>

<script>
const STORAGE_KEY = 'serviceApp_admin_data_final';
const POST_STORAGE_KEY = 'serviceApp_job_posts';
const EMP_PREFIX = 'EMP_';
const CAT_PREFIX = 'cat_custom_'; 
let currentFilter = 'all';
let userTrackedContact = localStorage.getItem('user_tracked_contact') || ''; 
let categoriesList = []; 

function generateId(prefix=''){return prefix+Date.now().toString(36)+Math.random().toString(36).substr(2,5);}

function loadData(){
    try {
        const d = localStorage.getItem(STORAGE_KEY);
        const parsedData = d ? JSON.parse(d) : { categories: [], employees: [] };
        if (!Array.isArray(parsedData.categories) || parsedData.categories.length === 0) {
             const seed = seedData();
             categoriesList = seed.categories; 
             return seed;
        }
        categoriesList = parsedData.categories; 
        return parsedData;
    } catch (e) {
        const seed = seedData();
        categoriesList = seed.categories;
        return seed;
    }
}

function seedData(){
  const d={
    categories:[
      {id:'cat_plumber',name:'‡§™‡•ç‡§≤‡§Ç‡§¨‡§∞'},
      {id:'cat_electrician',name:'‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§®'},
      {id:'cat_carpenter',name:'‡§¨‡§¢‡§º‡§à'},
      {id:'cat_cleaner',name:'‡§∏‡§´‡§æ‡§à ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä'},
      {id:'cat_gardener',name:'‡§Æ‡§æ‡§≤‡•Ä'},
      {id:'cat_painter',name:'‡§™‡•á‡§Ç‡§ü‡§∞'},
      {id:'cat_ac_repair',name:'‡§è‡§∏‡•Ä ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞'},
      {id:'cat_home_tutor',name:'‡§π‡•ã‡§Æ ‡§ü‡•ç‡§Ø‡•Ç‡§ü‡§∞'},
      {id:'cat_cook',name:'‡§ñ‡§æ‡§®‡§æ ‡§¨‡§®‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡§æ'},
      {id:'cat_driver',name:'‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞'},
      {id:'cat_security',name:'‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ó‡§æ‡§∞‡•ç‡§°'},
      {id:'cat_delivery',name:'‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§¨‡•â‡§Ø/‡§ó‡§∞‡•ç‡§≤'},
      {id:'cat_laundry',name:'‡§ï‡§™‡§°‡§º‡•á ‡§ß‡•ã‡§®‡•á ‡§µ‡§æ‡§≤‡§æ'},
      {id:'cat_pest_control',name:'‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤'},
      {id:'cat_ro_repair',name:'RO / ‡§µ‡§æ‡§ü‡§∞ ‡§™‡•ç‡§Ø‡•Ç‡§∞‡•Ä‡§´‡§æ‡§Ø‡§∞ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞'},
      {id:'cat_mechanic',name:'‡§µ‡§æ‡§π‡§® ‡§Æ‡•à‡§ï‡•á‡§®‡§ø‡§ï (2/4 ‡§µ‡•ç‡§π‡•Ä‡§≤‡§∞)'},
      {id:'cat_beautician',name:'‡§¨‡•ç‡§Ø‡•Ç‡§ü‡•Ä‡§∂‡§ø‡§Ø‡§® / ‡§π‡•á‡§Ø‡§∞ ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤‡§ø‡§∏‡•ç‡§ü'},
      {id:'cat_yoga',name:'‡§Ø‡•ã‡§ó ‡§™‡•ç‡§∞‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï'},
      {id:'cat_massage',name:'‡§Æ‡§∏‡§æ‡§ú ‡§•‡•á‡§∞‡•á‡§™‡§ø‡§∏‡•ç‡§ü (Male/Female)'},
      {id:'cat_computer_repair',name:'‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ / ‡§≤‡•à‡§™‡§ü‡•â‡§™ ‡§∞‡§ø‡§™‡•á‡§Ø‡§∞'},
      {id:'cat_web_designer',name:'‡§µ‡•á‡§¨/‡§ó‡•ç‡§∞‡§æ‡§´‡§º‡§ø‡§ï ‡§°‡§ø‡§ú‡§º‡§æ‡§á‡§®‡§∞ (Freelancer)'},
      {id:'cat_tax_consultant',name:'‡§ü‡•à‡§ï‡•ç‡§∏/GST ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞'},
      {id:'cat_photographer',name:'‡§´‡•ã‡§ü‡•ã‡§ó‡•ç‡§∞‡§æ‡§´‡§∞ / ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã‡§ó‡•ç‡§∞‡§æ‡§´‡§∞'},
      {id:'cat_event_planner',name:'‡§á‡§µ‡•á‡§Ç‡§ü ‡§™‡•ç‡§≤‡§æ‡§®‡§∞'},
      {id:'cat_movers',name:'‡§™‡•à‡§ï‡§∞‡•ç‡§∏ ‡§è‡§Ç‡§° ‡§Æ‡•Ç‡§µ‡§∞‡•ç‡§∏'},
      {id:'cat_babysitter',name:'‡§¨‡•á‡§¨‡•Ä ‡§∏‡§ø‡§ü‡§∞ / ‡§Ü‡§Ø‡§æ'},
      {id:'cat_elder_care',name:'‡§¨‡•Å‡§ú‡•Å‡§∞‡•ç‡§ó‡•ã‡§Ç ‡§ï‡•Ä ‡§¶‡•á‡§ñ‡§≠‡§æ‡§≤'},
      {id:'cat_tailor',name:'‡§¶‡§∞‡•ç‡§ú‡•Ä (Tailor)'},
      {id:'cat_welder',name:'‡§µ‡•á‡§≤‡•ç‡§°‡§∞'},
      {id:'cat_dhobi',name:'‡§ß‡•ã‡§¨‡•Ä / ‡§°‡•ç‡§∞‡§æ‡§à ‡§ï‡•ç‡§≤‡•Ä‡§®‡§ø‡§Ç‡§ó'},
      {id:'cat_vahan_chalak',name:'‡§µ‡§æ‡§π‡§® ‡§ö‡§æ‡§≤‡§ï (Commercial)'},
      {id:'cat_safai_sup',name:'‡§∏‡§´‡§æ‡§à ‡§∏‡•Å‡§™‡§∞‡§µ‡§æ‡§á‡§ú‡§∞'},
      {id:'cat_tiles',name:'‡§ü‡§æ‡§á‡§≤‡•ç‡§∏ / ‡§Æ‡§æ‡§∞‡•ç‡§¨‡§≤ ‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞'},
      {id:'cat_gypsum',name:'‡§ú‡§ø‡§™‡•ç‡§∏‡§Æ/POP ‡§ï‡§æ‡§∞‡•Ä‡§ó‡§∞'},
    ],
    employees:[
      {id:generateId(EMP_PREFIX),categoryId:'cat_plumber',name:'‡§∞‡§Æ‡•á‡§∂ ‡§ï‡•Å‡§Æ‡§æ‡§∞',experience:5,contact:'9876543210'},
      {id:generateId(EMP_PREFIX),categoryId:'cat_electrician',name:'‡§∏‡•Å‡§∞‡•á‡§∂ ‡§∏‡§ø‡§Ç‡§π',experience:8,contact:'9988776655'},
      {id:generateId(EMP_PREFIX),categoryId:'cat_cook',name:'‡§™‡•ç‡§∞‡•Ä‡§§‡§ø ‡§∂‡§∞‡•ç‡§Æ‡§æ',experience:3,contact:'9123456789'},
      {id:generateId(EMP_PREFIX),categoryId:'cat_mechanic',name:'‡§Ö‡§ú‡§Ø ‡§µ‡§∞‡•ç‡§Æ‡§æ',experience:10,contact:'9000000001'},
    ]
  };
  return d;
}

function loadPosts(){
    const posts = localStorage.getItem(POST_STORAGE_KEY);
    return posts ? JSON.parse(posts) : [];
}

function savePosts(posts){
    try {localStorage.setItem(POST_STORAGE_KEY, JSON.stringify(posts));} catch (e) {console.error("Post save error:", e);}
}
function saveData(data){try {localStorage.setItem(STORAGE_KEY,JSON.stringify(data));}catch (e) {console.error("Employee data save error:",e);}}
function saveTrackedContact(contact){
    userTrackedContact = contact;
    localStorage.setItem('user_tracked_contact', contact);
}


function toggleCategorySelect(newCategoryValue) {
    const select = document.getElementById('emp_category');
    if (newCategoryValue.trim().length > 0) {
        select.value = ""; 
        select.disabled = true; 
    } else {
        select.disabled = false; 
    }
}

function toggleNewCategoryInput(selectValue) {
    const input = document.getElementById('emp_new_category');
    if (selectValue !== "") {
        input.value = ""; 
        input.disabled = true; 
    } else {
        input.disabled = false; 
    }
}


function populateAllCategorySelects(categories) {
    const empSelect = document.getElementById('emp_category');
    const postSelect = document.getElementById('post_category');
    
    if (!empSelect || !postSelect) return; 

    const currentEmpVal = empSelect.value;
    const currentPostVal = postSelect.value;

    empSelect.innerHTML = '<option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
    postSelect.innerHTML = '<option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';

    categories.forEach(cat => {
        empSelect.appendChild(new Option(cat.name, cat.id));
        postSelect.appendChild(new Option(cat.name, cat.id));
    });
    
    empSelect.value = currentEmpVal;
    postSelect.value = currentPostVal;
}

function renderCategoryNav(data){
  const nav=document.getElementById('categoryNav');nav.innerHTML='';
  
  if (data.categories.length === 0) {
      nav.innerHTML = '<li class="category-item" style="color:#dc3545; padding: 0 20px;">‡§ï‡•ã‡§à ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§</li>';
      return;
  }
  
  const all=document.createElement('li');
  all.className='category-item';
  all.innerHTML=`<a href="javascript:void(0)" class="category-link ${currentFilter==='all'?'active':''}" data-category-id="all" data-category-name="‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç">‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç</a>`;
  all.querySelector('a').onclick=()=>selectCategory('all', '‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç');
  nav.appendChild(all);

  data.categories.forEach(c=>{
    const li=document.createElement('li');
    li.className='category-item';
    li.innerHTML=`<a href="javascript:void(0)" class="category-link ${currentFilter===c.id?'active':''}" data-category-id="${c.id}" data-category-name="${c.name}">${c.name}</a>`;
    li.querySelector('a').onclick=()=>selectCategory(c.id, c.name);
    nav.appendChild(li);
  });
}

function setFilter(id){
  currentFilter=id;const d=loadData();
  renderEmployees(d,id);
  
  const input = document.getElementById('categorySearchInput');
  const cat = categoriesList.find(c => c.id === id);

  input.value = (id === 'all' || !cat) ? '' : cat.name;

  document.querySelectorAll('.category-link').forEach(l=>{
    const isActive = l.dataset.categoryId===id;
    l.classList.toggle('active', isActive);
    if(isActive) l.parentElement.scrollIntoView({ behavior: 'smooth', inline: 'center' });
  });
}

function renderEmployees(data,filter){
  const grid=document.getElementById('karmchariGrid');
  grid.innerHTML='';
  
  const f=filter==='all'?data.employees:data.employees.filter(e=>e.categoryId===filter);
  
  if(!f.length){grid.innerHTML='<p style="text-align:center;color:red;">‡§ï‡•ã‡§à ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§</p>';return;}
  
  f.forEach(e=>{
    const c=data.categories.find(c=>c.id===e.categoryId) || {name: '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§'};
    const cleanContact = String(e.contact).replace(/\D/g, ''); 
    const w=`https://wa.me/91${cleanContact}?text=${encodeURIComponent(`‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•Å‡§ù‡•á ${c.name} ‡§ï‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§`)}`;
    
    const cardHTML = `
      <div class="karmchari-card">
        <div class="category-tag">${c.name}</div>
        <h3>${e.name}</h3>
        <p><strong>‡§Ö‡§®‡•Å‡§≠‡§µ:</strong> ${e.experience} ‡§∏‡§æ‡§≤</p>
        <div class="contact-buttons">
          <a href="tel:+91${cleanContact}" class="call-btn">‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç</a>
          <a href="${w}" target="_blank" class="whatsapp-btn">‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™</a>
        </div>
      </div>`;
    
    grid.insertAdjacentHTML('beforeend', cardHTML);
  });
}

function renderSuggestions(query) {
    const suggestionsBox = document.getElementById('categorySuggestions');
    suggestionsBox.innerHTML = '';
    const lowerQuery = query.toLowerCase().trim();

    if (!lowerQuery) {
        suggestionsBox.innerHTML += `<div class="suggestion-item" data-category-id="all" data-category-name="‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç">‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç</div>`;
    }
    
    const filtered = categoriesList.filter(cat => cat.name.toLowerCase().includes(lowerQuery));

    if (filtered.length === 0 && lowerQuery) {
        suggestionsBox.style.display = 'none';
        return;
    }

    filtered.forEach(cat => {
        const highlightedName = cat.name.replace(new RegExp(lowerQuery, 'gi'), match => `<span class="suggestion-highlight">${match}</span>`);
        suggestionsBox.innerHTML += `<div class="suggestion-item" data-category-id="${cat.id}" data-category-name="${cat.name}">${highlightedName}</div>`;
    });

    suggestionsBox.style.display = 'block';

    suggestionsBox.querySelectorAll('.suggestion-item').forEach(item => {
        item.addEventListener('mousedown', function() { 
            selectCategory(this.dataset.categoryId, this.dataset.categoryName);
        });
    });
}

function selectCategory(categoryId, categoryName) {
    document.getElementById('categorySearchInput').value = categoryName === '‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç' ? '' : categoryName; 
    document.getElementById('categorySuggestions').style.display = 'none'; 
    setFilter(categoryId); 
}

function setupCategorySearch() {
    const input = document.getElementById('categorySearchInput');
    const suggestionsBox = document.getElementById('categorySuggestions');
    
    input.addEventListener('input', () => renderSuggestions(input.value));
    input.addEventListener('focus', () => renderSuggestions(input.value));
    input.addEventListener('blur', () => setTimeout(() => { suggestionsBox.style.display = 'none'; }, 150));
    
    input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const firstSuggestion = suggestionsBox.querySelector('.suggestion-item');
            if (firstSuggestion && suggestionsBox.style.display === 'block') {
                e.preventDefault();
                selectCategory(firstSuggestion.dataset.categoryId, firstSuggestion.dataset.categoryName);
            }
        }
    });
}

// --- Available Jobs Renderer (THE FIX) ---
function renderAvailableJobs(categories) {
    const container = document.getElementById('availableJobsContainer');
    const posts = loadPosts();
    document.getElementById('jobPostCount').textContent = posts.length;
    container.innerHTML = ''; // ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç

    if (posts.length === 0) {
        container.innerHTML = '<p style="text-align:center;">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ï‡§æ‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>';
        return;
    }

    // ‡§∏‡§¨‡§∏‡•á ‡§®‡§à ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§™‡§π‡§≤‡•á ‡§¶‡§ø‡§ñ‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡•â‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç
    posts.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0)); 

    posts.forEach(p => {
        const cat = categories.find(c => c.id === p.category);
        const catName = cat ? cat.name : '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§';
        const cleanContact = String(p.contactNumber).replace(/\D/g, ''); 
        
        const whatsappMessage = encodeURIComponent(`‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ü‡§™‡§ï‡•Ä ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü (${catName}) ‡§¶‡•á‡§ñ‡•Ä ‡§π‡•à‡•§ ‡§Æ‡•à‡§Ç ‡§Ø‡§π ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•Ç‡§Å‡•§`);
        const w = `https://wa.me/91${cleanContact}?text=${whatsappMessage}`;

        container.innerHTML += `
            <div class="job-card">
                <p><strong>‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä:</strong> ${catName}</p>
                <p><strong>‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${p.details}</p>
                <p><strong>‡§ú‡§º‡§∞‡•Ç‡§∞‡§§:</strong> ${p.duration}</p>
                <p><strong>‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡§æ:</strong> ${p.contactName}</p>
                <div class="action-buttons">
                    <a href="tel:+91${cleanContact}" class="delete-btn" style="background: #dc3545; color: white; flex: 1; text-align: center; line-height: 20px; text-decoration: none;">‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç</a>
                    <a href="${w}" target="_blank" class="edit-btn" style="background: #28a745; color: white; flex: 1; text-align: center; line-height: 20px; text-decoration: none;">‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§™‡§∞ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç</a>
                </div>
            </div>
        `;
    });
}

function resetJobPostForm(categories, isUpdate=false) {
    document.getElementById('jobPostForm').reset();
    if (userTrackedContact) {
        document.getElementById('post_contact_number').value = userTrackedContact; 
    }
    document.getElementById('editingPostId').value = '';
    const btn = document.getElementById('submitJobPostBtn');
    btn.textContent = '‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç';
    btn.style.background = '#007bff';
    populateAllCategorySelects(categories); 
    if(!isUpdate) document.getElementById('postMessage').style.display = 'none';
}

function handleJobPost(e) {
    e.preventDefault();
    
    const id = document.getElementById('editingPostId').value;
    const category = document.getElementById('post_category').value;
    const details = document.getElementById('post_work_details').value.trim();
    const contactName = document.getElementById('post_contact_name').value.trim();
    const contactNumber = document.getElementById('post_contact_number').value.trim().replace(/\D/g, ''); 
    const duration = document.getElementById('post_duration').value.trim();
    
    const btn = document.getElementById('submitJobPostBtn');
    const originalText = btn.textContent;
    btn.disabled = true;
    btn.innerHTML = '<span class="loading-spinner"></span> <span>‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£...</span>';

    if (!category || !details || !contactName || contactNumber.length < 10 || !duration) {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§∏‡§π‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§≠‡§∞‡•á‡§Ç‡•§');
        btn.disabled = false; btn.innerHTML = originalText;
        return;
    }
    
    let posts = loadPosts();
    let message = '‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡•Ä ‡§ó‡§à!';

    if (id) {
        const index = posts.findIndex(p => p.id === id);
        if (index !== -1) {
            posts[index] = { ...posts[index], category, details, contactName, contactNumber, duration };
            message = '‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à!';
        }
    } else {
        const newPost = { id: generateId('POST_'), category, details, contactName, contactNumber, duration, timestamp: Date.now() };
        posts.push(newPost);
    }
    
    savePosts(posts);
    saveTrackedContact(contactNumber); 
    
    const postMsg = document.getElementById('postMessage');
    postMsg.textContent = message;
    postMsg.style.display = 'block';
    
    const categories = loadData().categories;
    renderMyPosts(categories);
    resetJobPostForm(categories, true); 
    
    btn.disabled = false; btn.innerHTML = originalText;
    
    setTimeout(() => { 
        postMsg.style.display = 'none';
        if (document.getElementById('availableJobsSection').classList.contains('active')) {
             renderAvailableJobs(categories);
        }
    }, 3000);
}

function renderMyPosts(categories) { 
     userTrackedContact = localStorage.getItem('user_tracked_contact') || ''; 
     const myPosts = loadPosts().filter(p => p.contactNumber === userTrackedContact); 
     document.getElementById('myPostCount').textContent = myPosts.length;
     const container = document.getElementById('myPostsContainer');
     container.innerHTML = myPosts.length === 0 
         ? `<p style="text-align: center; color: #555;">‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•ã‡§à ‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡•§</p>`
         : myPosts.map(p => {
             const cat = categories.find(c => c.id === p.category);
             const catName = cat ? cat.name : '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§';
             return `
                 <div class="job-card" id="my-post-${p.id}">
                     <p><strong>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä:</strong> ${catName}</p>
                     <p><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${p.details}</p>
                     <p><strong>‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ:</strong> ${p.duration}</p>
                     <div class="action-buttons">
                         <button class="edit-btn" onclick="editPost('${p.id}')">‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                         <button class="delete-btn" onclick="deletePost('${p.id}')">‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                     </div>
                 </div>`;
         }).join('');
}

function deletePost(postId) {
    if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡§ö ‡§Æ‡•á‡§Ç ‡§Ø‡§π ‡§™‡•ã‡§∏‡•ç‡§ü ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
        let posts = loadPosts().filter(p => p.id !== postId);
        savePosts(posts);
        const categories = loadData().categories;
        renderMyPosts(categories); 
        renderAvailableJobs(categories);
        if (document.getElementById('editingPostId').value === postId) {
            resetJobPostForm(categories);
        }
    }
}

function editPost(postId) {
    const post = loadPosts().find(p => p.id === postId);
    if (!post) return;

    switchSection('profileSection');
    
    document.getElementById('editingPostId').value = postId;
    document.getElementById('post_category').value = post.category;
    document.getElementById('post_work_details').value = post.details;
    document.getElementById('post_contact_name').value = post.contactName;
    document.getElementById('post_contact_number').value = post.contactNumber;
    document.getElementById('post_duration').value = post.duration;

    const btn = document.getElementById('submitJobPostBtn');
    btn.textContent = '‡§™‡•ã‡§∏‡•ç‡§ü ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç';
    btn.style.background = '#ffc107'; 

    btn.scrollIntoView({ behavior: 'smooth' });
}

function handleEmployeeRegistration(e) {
    e.preventDefault();
    
    const btn = document.getElementById('registerEmployeeBtn');
    const registerIcon = document.getElementById('registerIcon');
    const registerText = document.getElementById('registerText');
    const originalText = '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç';

    btn.disabled = true;
    registerIcon.className = 'loading-spinner'; 
    registerText.textContent = '‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';

    const name = document.getElementById('emp_name').value.trim();
    let categoryId = document.getElementById('emp_category').value; 
    const newCategoryName = document.getElementById('emp_new_category').value.trim();
    const exp = parseInt(document.getElementById('emp_exp').value);
    const contact = document.getElementById('emp_contact').value.trim().replace(/\D/g, ''); 

    const resetBtnState = () => {
        btn.disabled = false;
        registerIcon.className = 'material-icons';
        registerIcon.textContent = 'how_to_reg';
        registerText.textContent = originalText;
    };

    if (!categoryId && !newCategoryName) {
         alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡§§‡§æ ‡§ï‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç ‡§Ø‡§æ ‡§®‡§à ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§'); 
         resetBtnState();
         return;
    }
    
    if (!name || isNaN(exp) || contact.length < 10) {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§π‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§≠‡§∞‡•á‡§Ç‡•§'); 
        resetBtnState();
        return;
    }

    let data = loadData();
    
    if (data.employees.some(emp => emp.contact === contact)) {
        alert('‡§Ø‡§π ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§π‡•à‡•§');
        resetBtnState();
        return;
    }

    if (newCategoryName) {
        const existingCat = data.categories.find(c => c.name.toLowerCase() === newCategoryName.toLowerCase());
        categoryId = existingCat ? existingCat.id : generateId(CAT_PREFIX);
        if (!existingCat) {
            data.categories.push({ id: categoryId, name: newCategoryName });
        }
    }
    
    data.employees.push({ id: generateId(EMP_PREFIX), categoryId, name, experience: exp, contact });
    saveData(data); 

    registerIcon.className = 'material-icons';
    registerIcon.textContent = 'done_all'; 
    registerText.textContent = '‡§∏‡§´‡§≤!';
    btn.style.background = 'rgb(21, 87, 36)'; 

    document.getElementById('employeeRegisterForm').reset();
    toggleNewCategoryInput('');
    toggleCategorySelect('');

    setTimeout(() => { 
        btn.style.background = ''; 
        resetBtnState();
        switchSection('homeSection'); 
        setFilter(categoryId); 
    }, 2000);
}

function switchSection(targetSectionId){
    document.querySelectorAll('.nav-item-bottom').forEach(n => n.classList.remove('active'));
    document.querySelector(`[data-section="${targetSectionId}"]`).classList.add('active');
    document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(targetSectionId).classList.add('active');

    const data = loadData();
    const categories = data.categories;

    switch(targetSectionId) {
        case 'homeSection':
            renderCategoryNav(data); 
            setFilter(currentFilter || 'all'); 
            break;
        case 'availableJobsSection':
            renderAvailableJobs(categories);
            break;
        case 'profileSection':
            populateAllCategorySelects(categories); 
            renderMyPosts(categories); 
            resetJobPostForm(categories); 
            break;
        case 'employeeRegisterSection':
            populateAllCategorySelects(categories); 
            document.getElementById('employeeRegisterForm').reset();
            toggleNewCategoryInput('');
            toggleCategorySelect('');
            break;
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
}

document.addEventListener('DOMContentLoaded', () => {
     document.getElementById('employeeRegisterForm').addEventListener('submit', handleEmployeeRegistration);
     document.getElementById('jobPostForm').addEventListener('submit', handleJobPost);
     document.querySelectorAll('.bottom-nav .nav-item-bottom').forEach(item => {
         item.addEventListener('click', (e) => {
             e.preventDefault();
             switchSection(e.currentTarget.dataset.section);
         });
     });
     
     setupCategorySearch();
     document.getElementById('emp_category').addEventListener('change', (e) => toggleNewCategoryInput(e.target.value));
     document.getElementById('emp_new_category').addEventListener('input', (e) => toggleCategorySelect(e.target.value));
     
     switchSection('homeSection');
});
</script>

</body>
</html>
