<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§¨‡•Å‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•á‡§µ‡§æ - ‡§ò‡§∞ ‡§™‡§∞ ‡§∏‡•á‡§µ‡§æ‡§è‡§Å</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* Base Styles */
    body { font-family: 'Poppins', sans-serif; margin: 0; background: #f7f7f9; color: #333; padding-bottom: 60px; }
    .container { padding: 20px; max-width: 1000px; margin: auto; }
    h1 { text-align: center; color: #007bff; margin-bottom: 20px; }
    h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-top: 20px; font-weight: 600; }
    .content-section { display: none; }
    .content-section.active { display: block; }

    /* Search + Category */
    .search-container { position: relative; margin-bottom: 20px; }
    #categorySearchInput { width: 100%; padding: 10px 40px 10px 15px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
    .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #007bff; }

    .category-navbar { background: #fff; padding: 8px 0; border-bottom: 1px solid #eee; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .category-list { display: flex; overflow-x: auto; list-style: none; padding: 0 10px; margin: 0; scrollbar-width: none; }
    .category-list::-webkit-scrollbar { display: none; }
    .category-item { flex-shrink: 0; margin-right: 10px; }
    .category-link { padding: 8px 15px; border-radius: 20px; border: 1px solid #ccc; color: #333; background: #fff; text-decoration: none; display: block; white-space: nowrap; }
    .category-link.active { background: #007bff; color: #fff; border-color: #007bff; }

    /* Cards */
    .karmchari-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-top: 20px; min-height: 200px; }
    .karmchari-card { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); border-left: 5px solid #007bff; }
    .category-tag { background: #ffc107; padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; display: inline-block; margin-bottom: 5px; }
    .contact-buttons { display: flex; gap: 10px; margin-top: 10px; }
    .contact-buttons a { flex: 1; text-align: center; padding: 10px; border-radius: 5px; color: #fff; text-decoration: none; font-weight: 600; }
    .call-btn { background: #dc3545; }
    .whatsapp-btn { background: #28a745; }

    /* Job Card Styles */
    .job-card { background: #e6f7ff; border: 1px solid #cceeff; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid #007bff; }
    .job-card p { margin: 5px 0; }
    .job-card strong { color: #007bff; }
    
    /* Forms & Form Icons */
    .form-container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 15px; }
    .form-group-icon { position: relative; margin-bottom: 15px; }
    .form-group-icon .material-icons { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #007bff; font-size: 20px; pointer-events: none; }
    .form-group-icon input, .form-group-icon select, textarea {
        width: 100%; padding: 10px 10px 10px 40px; border-radius: 5px; border: 1px solid #ccc;
        box-sizing: border-box; transition: border-color 0.3s; 
    }
    textarea { padding-left: 10px !important; } /* Override icon padding for textarea */
    #employeeRegisterSection input, #employeeRegisterSection select { padding-left: 40px; }
    select { -webkit-appearance: none; -moz-appearance: none; appearance: none; padding-right: 10px; }
    
    /* Buttons */
    .form-btn { background: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; font-weight: 600; transition: background 0.3s;}
    .form-btn:hover { background: #0056b3; }
    #employeeRegisterForm button { background: #28a745; }
    
    /* Messages */
    .message { margin-top: 10px; padding: 8px; border-radius: 4px; font-weight: bold; }
    .success-msg { color: #155724; background-color: #d4edda; border: 1px solid #c3e6cb; display: none; }
    

    /* Bottom Nav */
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-around; background: #fff; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 10; }
    .nav-item-bottom { display: flex; flex-direction: column; align-items: center; padding: 6px 0; font-size: 0.8em; text-decoration: none; color: #777; flex-grow: 1; min-width: 60px; }
    .nav-item-bottom.active { color: #007bff; font-weight: 600; }
    .nav-item-bottom span { font-size: 22px; }
  </style>
</head>
<body>

<div class="container">
  <!-- 1. üè† ‡§π‡•ã‡§Æ ‡§∏‡•á‡§ï‡•ç‡§∂‡§® (‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä) -->
  <div id="homeSection" class="content-section active">
    <h1>‡§π‡§Æ‡§æ‡§∞‡•á ‡§Ö‡§®‡•Å‡§≠‡§µ‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä</h1>
    <div class="search-container">
      <input type="text" id="categorySearchInput" placeholder="‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ñ‡•ã‡§ú‡•á‡§Ç...">
      <span class="material-icons search-icon">search</span>
    </div>
    <div class="category-navbar">
      <ul id="categoryNav" class="category-list">
        <!-- Categories load here -->
      </ul>
    </div>
    <div id="karmchariGrid" class="karmchari-grid">
      <p id="loadingMessage" style="text-align:center;">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
    </div>
  </div>

  <!-- 2. üíº ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§æ‡§Æ -->
  <div id="availableJobsSection" class="content-section">
    <h1>‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§æ‡§Æ (<span id="jobPostCount">0</span> ‡§è‡§ï‡•ç‡§ü‡§ø‡§µ ‡§™‡•ã‡§∏‡•ç‡§ü)</h1>
    <div id="availableJobsContainer">
        <!-- Job posts render here -->
        <p style="text-align:center;">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ï‡§æ‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>
    </div>
  </div>

  <!-- 3. ‚ûï ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ (‡§ú‡•Å‡§°‡§º‡•á‡§Ç) -->
  <div id="employeeRegisterSection" class="content-section">
    <h2>‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç</h2>
     <form id="employeeRegisterForm" class="form-container">
        
        <label for="emp_name">‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ</label>
        <div class="form-group-icon">
            <span class="material-icons">person</span>
            <input type="text" id="emp_name" placeholder="‡§ú‡•à‡§∏‡•á: ‡§Æ‡•ã‡§π‡§® ‡§≤‡§æ‡§≤" required>
        </div>
        
        <label for="emp_category">‡§Ü‡§™‡§ï‡•Ä ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡§§‡§æ (‡§∂‡•ç‡§∞‡•á‡§£‡•Ä)</label>
        <div class="form-group-icon">
            <span class="material-icons">engineering</span>
            <select id="emp_category" required>
                 <option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
            </select>
        </div>

        <label for="emp_exp">‡§Ö‡§®‡•Å‡§≠‡§µ (‡§µ‡§∞‡•ç‡§∑‡•ã‡§Ç ‡§Æ‡•á‡§Ç)</label>
        <div class="form-group-icon">
            <span class="material-icons">military_tech</span>
            <input type="number" id="emp_exp" min="0" max="50" placeholder="‡§â‡§¶‡§æ‡§π‡§∞‡§£: 5" required>
        </div>
        
        <label for="emp_contact">‡§Ü‡§™‡§ï‡§æ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ (WhatsApp/Call)</label>
        <div class="form-group-icon">
            <span class="material-icons">phone</span>
            <input type="text" id="emp_contact" inputmode="numeric" placeholder="91XXXXXXXXXX" required>
        </div>

        <button type="submit">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§ï‡§∞‡•á‡§Ç</button>
        <p id="empRegisterMessage" class="message success-msg">‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤! ‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ ‡§π‡•ã‡§Æ ‡§™‡•á‡§ú ‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§®‡•á ‡§≤‡§ó‡•á‡§ó‡§æ‡•§</p>
    </form>
  </div>

  <!-- 4. üë§ ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤ (‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü) -->
  <div id="profileSection" class="content-section">
    <h2>‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</h2>
    <p>‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§ï‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§</p>

    <form id="jobPostForm" class="form-container">
        
        <label for="post_category">‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä</label>
        <div class="form-group-icon">
            <span class="material-icons">category</span>
            <select id="post_category" required>
                 <option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
            </select>
        </div>

        <label for="post_work_details">‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£</label>
        <textarea id="post_work_details" rows="3" placeholder="‡§ú‡•à‡§∏‡•á: ‡§Æ‡•á‡§∞‡•á ‡§ò‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§á‡§™ ‡§ü‡•Ç‡§ü ‡§ó‡§Ø‡§æ ‡§π‡•à, ‡§á‡§∏‡•á ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§†‡•Ä‡§ï ‡§ï‡§∞‡§µ‡§æ‡§®‡§æ ‡§π‡•à‡•§" required></textarea>

        <label for="post_contact_name">‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
        <div class="form-group-icon">
            <span class="material-icons">person</span>
            <input type="text" id="post_contact_name" required>
        </div>

        <label for="post_contact_number">‡§Ü‡§™‡§ï‡§æ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ (WhatsApp/Call)</label>
        <div class="form-group-icon">
            <span class="material-icons">phone</span>
            <input type="text" id="post_contact_number" inputmode="numeric" placeholder="91XXXXXXXXXX" required>
        </div>

        <label for="post_duration">‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§Ø/‡§Ö‡§µ‡§ß‡§ø</label>
        <div class="form-group-icon">
            <span class="material-icons">schedule</span>
            <input type="text" id="post_duration" placeholder="‡§ú‡•à‡§∏‡•á: 4 ‡§ò‡§Ç‡§ü‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ü‡§ú ‡§∂‡§æ‡§Æ ‡§ï‡•ã" required>
        </div>

        <button type="submit" class="form-btn">‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
        <p id="postMessage" class="message success-msg">‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡•Ä ‡§ó‡§à!</p>
    </form>
    
    <h2 style="margin-top: 30px;">‡§Ü‡§™‡§ï‡•Ä ‡§™‡§ø‡§õ‡§≤‡•Ä ‡§™‡•ã‡§∏‡•ç‡§ü (<span id="myPostCount">0</span>)</h2>
    <div id="myPostsContainer">
        <!-- User's previous posts render here -->
        <p style="text-align: center; color: #555;">‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•ã‡§à ‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡•§</p>
    </div>
  </div>
</div>

<!-- ‚öìÔ∏è ‡§¨‡•â‡§ü‡§Æ ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§∂‡§® -->
<div class="bottom-nav">
  <a href="#" class="nav-item-bottom active" data-section="homeSection">
    <span class="material-icons">engineering</span> ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä
  </a>
  <a href="#" class="nav-item-bottom" data-section="availableJobsSection">
    <span class="material-icons">work_outline</span> ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§æ‡§Æ
  </a>
  <a href="#" class="nav-item-bottom" data-section="employeeRegisterSection">
    <span class="material-icons">person_add</span> ‡§ú‡•Å‡§°‡§º‡•á‡§Ç
  </a>
  <a href="#" class="nav-item-bottom" data-section="profileSection">
    <span class="material-icons">person</span> ‡§™‡•ç‡§∞‡•ã‡§´‡§º‡§æ‡§á‡§≤
  </a>
</div>

<script>
const STORAGE_KEY = 'serviceApp_admin_data_final';
const POST_STORAGE_KEY = 'serviceApp_job_posts';
const EMP_PREFIX = 'EMP_';
let currentFilter = 'all';
// Use a constant user contact number for simulating 'My Posts' functionality
const DEMO_USER_CONTACT = '919876543210'; 

function generateId(prefix=''){return prefix+Date.now().toString(36)+Math.random().toString(36).substr(2,5);}

// ‡§á‡§∏ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¶‡•Ä ‡§ó‡§à ‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§
function loadData(){
    try {
        const d = localStorage.getItem(STORAGE_KEY);
        const parsedData = d ? JSON.parse(d) : { categories: [], employees: [] };
        
        // ‡§Ö‡§ó‡§∞ categories ‡§ñ‡§æ‡§≤‡•Ä ‡§π‡•à, ‡§§‡•ã ‡§è‡§ï minimal seed ‡§°‡•á‡§ü‡§æ ‡§≤‡•å‡§ü‡§æ‡§è‡§Å
        if (!Array.isArray(parsedData.categories) || parsedData.categories.length === 0) {
             console.warn("Categories missing, using minimal seed data.");
             return seedData(); // Falls back to minimal seed
        }
        return parsedData;
    } catch (e) {
        console.error("Error loading data, using minimal seed data.", e);
        return seedData(); 
    }
}

function seedData(){
  // Minimal seed data, just in case the admin panel hasn't been run yet.
  const d={
    categories:[
      {id:'cat_plumber',name:'‡§™‡•ç‡§≤‡§Ç‡§¨‡§∞'},
      {id:'cat_electrician',name:'‡§á‡§≤‡•á‡§ï‡•ç‡§ü‡•ç‡§∞‡•Ä‡§∂‡§ø‡§Ø‡§®'},
      {id:'cat_carpenter',name:'‡§¨‡§¢‡§º‡§à'},
      {id:'cat_cleaner',name:'‡§∏‡§´‡§æ‡§à ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä'},
      {id:'cat_gardener',name:'‡§Æ‡§æ‡§≤‡•Ä'}
    ],
    employees:[
      {id:generateId(EMP_PREFIX),categoryId:'cat_plumber',name:'‡§∞‡§Æ‡•á‡§∂ ‡§ï‡•Å‡§Æ‡§æ‡§∞',experience:5,contact:'9876543210'},
      {id:generateId(EMP_PREFIX),categoryId:'cat_electrician',name:'‡§∏‡•Å‡§∞‡•á‡§∂ ‡§∏‡§ø‡§Ç‡§π',experience:8,contact:'9988776655'},
    ]
  };
  return d;
}

function loadPosts(){
    const posts = localStorage.getItem(POST_STORAGE_KEY);
    return posts ? JSON.parse(posts) : [];
}

function savePosts(posts){
    try {localStorage.setItem(POST_STORAGE_KEY, JSON.stringify(posts));} catch (e) {console.error("Post save error:", e);}
}
function saveData(data){try {localStorage.setItem(STORAGE_KEY,JSON.stringify(data));}catch (e) {console.error("Employee data save error:",e);}}


// --- Category Rendering and Filtering ---

function populateAllCategorySelects(categories) {
    const empSelect = document.getElementById('emp_category');
    const postSelect = document.getElementById('post_category');
    
    if (!empSelect || !postSelect) return; 

    const currentEmpVal = empSelect.value;
    const currentPostVal = postSelect.value;

    empSelect.innerHTML = '<option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
    postSelect.innerHTML = '<option value="">-- ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';

    categories.forEach(cat => {
        // Employee Select
        let opt1 = new Option(cat.name, cat.id);
        empSelect.appendChild(opt1);
        
        // Post Select
        let opt2 = new Option(cat.name, cat.id);
        postSelect.appendChild(opt2);
    });
    
    empSelect.value = currentEmpVal;
    postSelect.value = currentPostVal;
}

function renderCategoryNav(data){
  const nav=document.getElementById('categoryNav');nav.innerHTML='';
  
  if (data.categories.length === 0) {
      nav.innerHTML = '<li class="category-item" style="color:#dc3545; padding: 0 20px;">‡§ï‡•ã‡§à ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§</li>';
      return;
  }
  
  // '‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç' link
  const all=document.createElement('li');
  all.className='category-item';
  all.innerHTML=`<a href="javascript:void(0)" class="category-link ${currentFilter==='all'?'active':''}" data-category-id="all">‡§∏‡§≠‡•Ä ‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç</a>`;
  all.querySelector('a').onclick=(e)=>{e.preventDefault(); setFilter('all');};
  nav.appendChild(all);

  // Individual categories
  data.categories.forEach(c=>{
    const li=document.createElement('li');
    li.className='category-item';
    li.innerHTML=`<a href="javascript:void(0)" class="category-link ${currentFilter===c.id?'active':''}" data-category-id="${c.id}">${c.name}</a>`;
    li.querySelector('a').onclick=(e)=>{e.preventDefault(); setFilter(c.id);};
    nav.appendChild(li);
  });
}

function setFilter(id){
  currentFilter=id;const d=loadData();
  renderEmployees(d,id);
  
  // Highlight the active category link and scroll it into view
  document.querySelectorAll('.category-link').forEach(l=>{
    const isActive = l.dataset.categoryId===id;
    l.classList.toggle('active', isActive);
    if(isActive) l.parentElement.scrollIntoView({ behavior: 'smooth', inline: 'center' });
  });
}

function renderEmployees(data,filter){
  const grid=document.getElementById('karmchariGrid');
  grid.innerHTML='';
  
  const f=filter==='all'?data.employees:data.employees.filter(e=>e.categoryId===filter);
  
  if(!f.length){grid.innerHTML='<p style="text-align:center;color:red;">‡§ï‡•ã‡§à ‡§ï‡§∞‡•ç‡§Æ‡§ö‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç‡•§</p>';return;}
  
  f.forEach(e=>{
    const c=data.categories.find(c=>c.id===e.categoryId) || {name: '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§', id: 'unknown'};
    const cleanContact = String(e.contact).replace(/\D/g, ''); 
    const w=`https://wa.me/91${cleanContact}?text=${encodeURIComponent(`‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•Å‡§ù‡•á ${c.name} ‡§ï‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§ú‡•ã ‡§Ü‡§™‡§®‡•á ‡§¶‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§π‡•à‡•§`)}`;
    
    const cardHTML = `
      <div class="karmchari-card">
        <div class="category-tag">${c.name}</div>
        <h3>${e.name}</h3>
        <p><strong>‡§Ö‡§®‡•Å‡§≠‡§µ:</strong> ${e.experience} ‡§∏‡§æ‡§≤</p>
        <div class="contact-buttons">
          <a href="tel:+91${cleanContact}" class="call-btn">‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç</a>
          <a href="${w}" target="_blank" class="whatsapp-btn">‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™</a>
        </div>
      </div>`;
    
    grid.insertAdjacentHTML('beforeend', cardHTML);
  });
}

// --- Available Jobs Handlers (New) ---

function renderAvailableJobs(categories) { 
    const posts = loadPosts();
    document.getElementById('jobPostCount').textContent = posts.length;
    const container = document.getElementById('availableJobsContainer');
    container.innerHTML = '';
    
    if (posts.length === 0) {
        container.innerHTML = `<p style="text-align: center; color: #555;">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ï‡§æ‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>`;
        return;
    }
    
    posts.forEach(p => {
        const cat = categories.find(c => c.id === p.category);
        const catName = cat ? cat.name : '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§';
        
        // WhatsApp link to contact the user who posted the job
        const wLink = `https://wa.me/91${p.contactNumber}?text=${encodeURIComponent(`‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ü‡§™‡§ï‡•Ä ${catName} ‡§∏‡•á‡§µ‡§æ ‡§ï‡•Ä ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∏‡•ç‡§ü ‡§¶‡•á‡§ñ‡•Ä ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§ï‡§æ‡§Æ ‡§Ö‡§≠‡•Ä ‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•à? ‡§Æ‡•á‡§∞‡§æ ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ ${p.contactNumber} ‡§π‡•à‡•§`)}`;
        
        container.innerHTML += `
            <div class="job-card">
                <p><strong>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä:</strong> ${catName}</p>
                <p><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${p.details}</p>
                <p><strong>‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ:</strong> ${p.duration}</p>
                <p><strong>‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§æ‡§Æ:</strong> ${p.contactName}</p>
                <div class="contact-buttons" style="margin-top:5px;">
                     <a href="tel:+91${p.contactNumber}" class="call-btn" style="flex:auto;">‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç (${p.contactNumber})</a>
                     <a href="${wLink}" target="_blank" class="whatsapp-btn" style="flex:auto;">‡§µ‡•ç‡§π‡§æ‡§ü‡•ç‡§∏‡§è‡§™ ‡§ï‡§∞‡•á‡§Ç</a>
                </div>
            </div>
        `;
    });
}

// --- My Posts / Job Request Handlers (New) ---

function handleJobPost(e) {
    e.preventDefault();
    
    const postForm = document.getElementById('jobPostForm');
    const category = document.getElementById('post_category').value;
    const details = postForm.querySelector('textarea#post_work_details').value.trim();
    const contactName = document.getElementById('post_contact_name').value.trim();
    const contactNumber = document.getElementById('post_contact_number').value.trim().replace(/\D/g, ''); // Clean contact
    const duration = document.getElementById('post_duration').value.trim();
    
    if (!category || !details || !contactName || contactNumber.length < 10 || !duration) {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§∏‡§π‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§≠‡§∞‡•á‡§Ç‡•§');
        return;
    }
    
    const newPost = {
        id: generateId('POST_'),
        category: category,
        details: details,
        contactName: contactName,
        contactNumber: contactNumber,
        duration: duration,
        timestamp: Date.now()
    };
    
    let posts = loadPosts();
    posts.push(newPost);
    savePosts(posts);

    const postMsg = document.getElementById('postMessage');
    postMsg.style.display = 'block';
    
    // Reset form after successful submission
    postForm.reset();

    // Re-render user's own posts immediately
    renderMyPosts(loadData().categories);

    // Hide message after a delay
    setTimeout(() => { 
        postMsg.style.display = 'none';
        // Suggest switching to available jobs to see the post (optional)
    }, 3000);
}


function renderMyPosts(categories) { 
     // For this demo, we'll assume a dummy contact number to identify 'My Posts'
     const myPosts = loadPosts().filter(p => p.contactNumber === '9123456789' || p.contactNumber === DEMO_USER_CONTACT); 
     document.getElementById('myPostCount').textContent = myPosts.length;
     const container = document.getElementById('myPostsContainer');
     container.innerHTML = '';
     
     if (myPosts.length === 0) {
          container.innerHTML = `<p style="text-align: center; color: #555;">‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•ã‡§à ‡§ú‡•â‡§¨ ‡§∞‡§ø‡§ï‡•ç‡§µ‡•á‡§∏‡•ç‡§ü ‡§™‡•ã‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡•§</p>`;
          return;
     }

     myPosts.forEach(p => {
        const cat = categories.find(c => c.id === p.category);
        const catName = cat ? cat.name : '‡§Ö‡§ú‡•ç‡§û‡§æ‡§§';
        
        container.innerHTML += `
            <div class="job-card">
                <p><strong>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä:</strong> ${catName}</p>
                <p><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${p.details}</p>
                <p><strong>‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ:</strong> ${p.duration}</p>
            </div>
        `;
    });
}


// --- Employee Registration Handler ---
function handleEmployeeRegistration(e) {
    e.preventDefault();
    
    const name = document.getElementById('emp_name').value.trim();
    const categoryId = document.getElementById('emp_category').value; 
    const exp = parseInt(document.getElementById('emp_exp').value);
    const contact = document.getElementById('emp_contact').value.trim().replace(/\D/g, ''); // Clean contact

    if (!name || categoryId === "" || isNaN(exp) || contact.length < 10) {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§≠‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§π‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§≠‡§∞‡•á‡§Ç‡•§'); 
        return;
    }

    let data = loadData();
    const newEmployee = {
        id: generateId(EMP_PREFIX), 
        categoryId: categoryId, 
        name: name,
        experience: exp, 
        contact: contact
    };
    
    if (data.employees.some(emp => emp.contact === contact)) {
        alert('‡§Ø‡§π ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§π‡•à‡•§');
        return;
    }

    data.employees.push(newEmployee);
    saveData(data); // Saves to the shared STORAGE_KEY

    const registerMsg = document.getElementById('empRegisterMessage');
    registerMsg.style.display = 'block';
    
    document.getElementById('employeeRegisterForm').reset();
    
    // Switch to Home and set filter to show the new employee
    setTimeout(() => { 
        switchSection('homeSection'); 
        setFilter(categoryId); 
        registerMsg.style.display = 'none';
    }, 3000);
}


// --- Master Switcher ---
function switchSection(targetSectionId){
    const data = loadData();
    const categories = data.categories;

    // 1. Manage Active Class (UI)
    document.querySelectorAll('.nav-item-bottom').forEach(n => n.classList.remove('active'));
    document.querySelector(`[data-section="${targetSectionId}"]`).classList.add('active');
    document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(targetSectionId).classList.add('active');

    // 2. Section Specific Logic
    if (targetSectionId === 'homeSection') {
         currentFilter = 'all'; 
         document.getElementById('categorySearchInput').value = '';
         // Render the Nav and Grid on return
         renderCategoryNav(data); 
         setFilter('all'); 
         
    } else if (targetSectionId === 'availableJobsSection') {
         renderAvailableJobs(categories);
    } else if (targetSectionId === 'profileSection') { 
         populateAllCategorySelects(categories); // for jobPostForm select
         renderMyPosts(categories); // show users own posts
    } else if (targetSectionId === 'employeeRegisterSection') { 
         populateAllCategorySelects(categories); // Populate the dropdown for registration
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
}


// --- Initialization ---

document.addEventListener('DOMContentLoaded', () => {
     // Attach all dynamic listeners
     document.getElementById('employeeRegisterForm').addEventListener('submit', handleEmployeeRegistration);
     document.getElementById('jobPostForm').addEventListener('submit', handleJobPost);
    
     document.querySelectorAll('.bottom-nav .nav-item-bottom').forEach(item => {
         item.addEventListener('click', function(e) {
             e.preventDefault();
             switchSection(this.getAttribute('data-section'));
         });
     });
     
     // Initial load: Go to home and render all
     switchSection('homeSection');
});
</script>

</body>
</html>
